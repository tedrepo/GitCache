(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5543589c"],{"01ee":function(t,e,n){},"22b6":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"kg-graph-container"}},[t._m(0),n("div",{staticClass:"svg-set-box clearfix"},[n("div",{staticClass:"ctwh-dibmr"},[n("span",[t._v("显示范围: ")]),t._l(t.pagesizelist,function(e,r){return n("a",{key:r,class:[e.isactive?"sd-active":"","ss-d sd"+(r+1)],attrs:{href:"javascript:void(0)"},on:{click:function(n){return t.setmatchsize(e,this)}}})})],2),n("div",{staticClass:"ctwh-dibmr",staticStyle:{float:"right"}},[n("ul",{staticClass:"toolbar"},[n("li",[n("a",{attrs:{href:"javascript:;"},on:{click:t.zoomIn}},[t._m(1)])]),n("li",[n("a",{attrs:{href:"javascript:;"},on:{click:t.zoomOut}},[t._m(2)])]),n("li",[n("a",{attrs:{href:"javascript:;"},on:{click:t.zoomIn}},[t._m(3)])]),n("li",[t.isFullscreen?n("a",{attrs:{id:"fullscreenbtn",href:"javascript:;"},on:{click:t.exitFullScreen}},[t._m(5)]):n("a",{attrs:{id:"fullscreenbtn",href:"javascript:;"},on:{click:t.showFull}},[t._m(4)])])])])])])},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{float:"left"},attrs:{id:"gid_tc"}},[n("div",{attrs:{id:"gid"}}),n("div",{staticClass:"mengceng"})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("i",{staticClass:"el-icon-zoom-in"}),t._v(" 放大 ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("i",{staticClass:"el-icon-zoom-out"}),t._v(" 缩小 ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("i",{staticClass:"el-icon-refresh-right"}),t._v(" 还原 ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("i",{staticClass:"el-icon-full-screen"}),t._v(" 全屏")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("i",{staticClass:"el-icon-full-screen"}),t._v("退出全屏")])}],a=(n("7f7f"),n("ac6a"),n("bc3a")),o=n.n(a),s=n("5698"),u={props:["pid"],data:function(){return{theme:0,loading:!1,width:1e3,height:800,gcontainer:{},svg:{},zoom:null,arrowMarker:{},simulation:{},isFullscreen:!1,qaGraphNode:{},qaButtonGroup:{},qaGraphNodeText:{},qaGraphLink:{},qaGraphLinkText:{},graph:{nodes:[],links:[]},defaultR:30,colorList:["#ff8373","#f9c62c","#a5ca34","#6fce7a","#70d3bd","#ea91b0"],pagesizelist:[{size:100,isactive:!1},{size:300,isactive:!1},{size:500,isactive:!0},{size:1e3,isactive:!1}],toolbarData:[{name:"编辑",value:1,code:"edit"},{name:"展开",value:1,code:"more"},{name:"追加",value:1,code:"append"},{name:"连线",value:1,code:"link"},{name:"删除",value:1,code:"delete"},{name:"收起",value:1,code:"close"},{name:"展示",value:1,code:"show"}],selectUuid:0,nodeRecordList:[]}},components:{},mounted:function(){this.respdata={node:[{name:"诸子百家",uuid:"1",imgsrc:""},{name:"儒家",uuid:"2",imgsrc:""},{name:"墨家",uuid:"3",imgsrc:""},{name:"道家",uuid:"4",imgsrc:""},{name:"法家",uuid:"5",imgsrc:""},{name:"名家",uuid:"6",imgsrc:""},{name:"阴阳家",uuid:"7",imgsrc:""},{name:"纵横家",uuid:"8",imgsrc:""},{name:"杂家",uuid:"9",imgsrc:""},{name:"农家",uuid:"10",imgsrc:""},{name:"小说家",uuid:"11",imgsrc:""},{name:"兵家",uuid:"12",imgsrc:""},{name:"医家",uuid:"13",imgsrc:""},{name:"学派来源",uuid:"14",imgsrc:""},{name:"学派发展",uuid:"15",imgsrc:""},{name:"代表人物",uuid:"16",imgsrc:""},{name:"代表著作",uuid:"17",imgsrc:""},{name:"思想主张",uuid:"18",imgsrc:""},{name:"名言警句",uuid:"19",imgsrc:""},{name:"故事轶闻",uuid:"20",imgsrc:""}],relationship:[{sourceid:"1",targetid:"2",name:"下位",uuid:"1002"},{sourceid:"1",targetid:"3",name:"下位",uuid:"1003"},{sourceid:"1",targetid:"4",name:"下位",uuid:"1004"},{sourceid:"1",targetid:"5",name:"下位",uuid:"1005"},{sourceid:"1",targetid:"6",name:"下位",uuid:"1006"},{sourceid:"1",targetid:"7",name:"下位",uuid:"1007"},{sourceid:"1",targetid:"8",name:"下位",uuid:"1008"},{sourceid:"1",targetid:"9",name:"下位",uuid:"1009"},{sourceid:"1",targetid:"10",name:"下位",uuid:"1010"},{sourceid:"1",targetid:"11",name:"下位",uuid:"1011"},{sourceid:"1",targetid:"12",name:"下位",uuid:"1012"},{sourceid:"1",targetid:"13",name:"下位",uuid:"1013"},{sourceid:"2",targetid:"14",name:"下位",uuid:"1014"},{sourceid:"2",targetid:"15",name:"下位",uuid:"1015"},{sourceid:"2",targetid:"16",name:"下位",uuid:"1016"},{sourceid:"2",targetid:"17",name:"下位",uuid:"1017"},{sourceid:"2",targetid:"18",name:"下位",uuid:"1018"},{sourceid:"2",targetid:"19",name:"下位",uuid:"1019"},{sourceid:"2",targetid:"20",name:"下位",uuid:"1020"},{sourceid:"2",targetid:"1",name:"上位",uuid:"1021"},{sourceid:"1",targetid:"2",name:"哈哈哈",uuid:"1023"}]},this.initGraphContainer(),this.addMarker(),this.initGraph()},created:function(){},computed:{},watch:{},methods:{initGraphContainer:function(){this.gcontainer=s["select"]("#gid"),this.isFullscreen?(this.width=window.screen.width,this.height=window.scroll.height):(this.width=this.width,this.height=this.height),this.svg=this.gcontainer.append("svg");var t=this.width,e=this.height;this.svg.attr("width",t),this.svg.attr("height",e),this.svg.attr("id","svg_idx"),this.svg.attr("preserveAspectRatio","xMidYMidmeet"),this.simulation=s["forceSimulation"]().force("charge",s["forceManyBody"]().strength(-1500)).force("link",s["forceLink"]().distance(60).id(function(t){return t.uuid})).force("collide",s["forceCollide"]().strength(-30)).force("center",s["forceCenter"](this.width/2,this.height/2)),this.qaGraphLink=this.svg.append("g").attr("class","line"),this.qaGraphLinkText=this.svg.append("g").attr("class","linetext"),this.qaGraphNode=this.svg.append("g").attr("class","node"),this.qaGraphNodeText=this.svg.append("g").attr("class","nodetext"),this.nodebuttonGroup=this.svg.append("g").attr("class","nodebutton"),this.svg.on("click",function(){s["selectAll"](".buttongroup").classed("notshow",!0)},!1),this.tooltip=s["select"]("body").append("div").attr("class","tooltip").style("opacity",0)},initGraph:function(){var t=this;o.a.get("./static/kgdata.json",{}).then(function(e){var n=e.data;n=t.respdata;console.log("加载的数据为: ",n),t.graph.nodes=n.node,t.graph.links=n.relationship,console.log("加载数据后 graph 内容为: ",t.graph),t.updateGraph()})},addMarker:function(){var t=this.svg.append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("markerWidth","12").attr("markerHeight","12").attr("viewBox","0 0 12 12").attr("refX","38").attr("refY","6").attr("orient","auto"),e="M2,2 L10,6 l2,10 L6,6 L2,2";t.append("path").attr("d",e).attr("fill","#ccc")},openNode:function(){var t=this,e=[],n=[];t.graph.nodes=t.graph.nodes.concat(e),t.graph.links=t.graph.links.concat(n)},drawNode:function(t){var e=this,n=this.qaGraphNode.selectAll("circle").data(t,function(t){return t.uuid});n.exit().remove();var r=n.enter().append("circle");return r.on("click",function(t){e.selectUuid=t.uuid;var n=".out_buttongroup_"+t.uuid,r=s["select"](n)._groups[0][0];r.classList.contains("notshow")?(e.svg.selectAll(".buttongroup").classed("notshow",!0),s["select"](n).classed("notshow",!1)):s["select"](n).classed("notshow",!0),event.stopPropagation()}),r.on("dbclick",function(t){console.log(t),event.preventDefault()}),r.on("mouseenter",function(t){s["select"](this).style("stroke-width","10"),e.tooltip.html("节点描述信息"+t).style("left",s["event"].pageX+"px").style("top",s["event"].pageY+20+"px").style("height","200px").style("opacity",.4),console.log(e.tooltip)}),r.on("mousemove",function(t){e.tooltip.style("left",s["event"].pageX+"px").style("top",s["event"].pageY+20+"px"),console.log(e.tooltip)}),r.on("mouseout",function(t){e.tooltip.style("opacity",0),console.log(e.tooltip)}),r.on("mouseleave",function(){s["select"](this).style("stroke-width",2),s["select"](".node").style("fill-opacity",1),s["select"](".nodetext").style("fill-opacity",1),s["selectAll"](".link").style("stroke-opacity",1),s["selectAll"](".linktext").style("fillopacity",1)}),r.on("mouseover",function(t){s["selectAll"](".node").style("fill-opacity",.1);var n=[];n=e.graph.links.filter(function(e){return e.sourceid==t.uuid||e.targetid==t.uuid});n.forEach(function(t){n.push(t.sourceid),n.push(t.targetid)}),e.qaGraphNode.selectAll("circle").style("fill-opacity",function(t){if(n.indexOf(t.uuid)>-1)return 1}),s["selectAll"](".nodetext").style("fill-opacity",.1),e.qaGraphNodeText.selectAll("text").style("fill-opacity",function(t){if(n.indexOf(t.uuid)>-1)return 1}),s["selectAll"](".line").style("stroke-opacity",.1),e.qaGraphLink.selectAll(".link").style("stroke-opacity",function(e){if(e.lk.targetid===t.uuid||e.lk.sourceid===t.uuid)return console.log(e),1}),s["selectAll"](".linetext").style("fill-opacity",.1),e.qaGraphNodeText.selectAll(".linktext").style("fill-opacity",function(e){if(e.lk.targetid===t.uuid||e.lk.sourceid===t.uuid)return 1})}),r.call(s["drag"]().on("start",e.dragStarted).on("drag",e.dragged).on("end",e.dragEnded)),n=r.merge(n).text(function(t){return t.name}),n.style("stroke",function(t){return t.color?t.color:"#A4ED6C"}),n.style("stroke-opacity",.6),n.attr("r",function(t){return t.r?t.r:0===t.index?28:20}),n.attr("fill",function(t,n){if(t.imgsrc){var r=77,i=80,a=s["selectAll"]("svg >defs"),o=a.append("pattern").attr("id","catpattern"+n).attr("height",1).attr("width",1);return o.append("image").attr("x",-(r/2-t.r)).attr("y",-(i/2-t.r)).attr("width",r).attr("height",i).attr("height",i).attr("xlink:href",t.imgsrc),"url(#catpattern"+n+")"}if("1"===t.cur)return e.colorList[0];var u=e.colorList;return u[Math.floor(Math.random()*u.length)]}),n.append("title").text(function(t){return t.name?t.name:""}),n},drawNodeText:function(t){var e=this,n=this.qaGraphNodeText.selectAll("text").data(t,function(t){return t.uuid});n.exit().remove();var r=n.enter().append("text");return r.call(s["drag"]().on("start",e.dragStarted).on("drag",e.dragged).on("end",e.dragEnded)),n=r.merge(n).text(function(t){return t.name}),n.style("fill",function(){return"#333"}).attr("class","nodetext").attr("dy","3.6em").attr("font-family","宋体").attr("font-size",16).attr("text-anchor","middle").text(function(t){return t.name}),n.append("title").append("title").text(function(t){return t.name?t.name:""}),n},drawLink:function(t){var e=this,n=this.qaGraphLink.selectAll(".link").data(t,function(t){return t.uuid});n.exit().remove();var r=n.enter().append("path").attr("class","link").attr("stroke-width",1).attr("stroke",function(){return e.colorList[2]}).attr("fill","none").attr("id",function(t){return"invis_"+t.lk.sourceid+"-"+t.lk.name+"-"+t.lk.targetid}).attr("marker-end","url(#arrow)");return n=r.merge(n),n},drawLinkText:function(t){var e=this,n=e.qaGraphLinkText.selectAll(".linktext").data(t,function(t){return t.uuid});n.exit().remove();var r=n.enter().append("text").attr("class","linktext").append("textPath").attr("startOffset","50%").attr("text-anchor","middle").attr("xlink:href",function(t){return"#invis_"+t.lk.sourceid+"-"+t.lk.name+"-"+t.lk.targetid}).style("fill","#875034").style("font-size","10px").text(function(t){return t.lk.name});return n=r.merge(n).text(function(t){return t.lk.name}),n},drawButtonGroup:function(t){var e=this;s["selectAll"](".nodebutton >g").remove();var n=e.nodebuttonGroup.selectAll(".nodebutton").data(t,function(t){return t.uuid});n.exit().remove();var r=n.enter().append("use").attr("r",function(t){return t.r?t.r:e.defaultR}).attr("uuid",function(t){return t.uuid}).attr("xlink:href",function(t){return t.r?"#out_circle_"+t.r:"#out_circle_"+e.defaultR}).attr("class",function(t){return"buttongroup out_buttongroup_"+t.uuid}).classed("notshow",!0);return n=r.merge(n),n},drawToolButton:function(){var t=this;s["selectAll"]("svg >defs").remove();var e=t.graph.nodes,n=s["pie"]().value(function(t){return t.value}),r=n(t.toolbarData),i=t.svg.append("defs"),a=[];e.forEach(function(e){if(e.r||(e.r=t.defaultR),-1==a.indexOf(e.r)){a.push(e.r);var n=i.append("g").attr("id","out_circle_"+e.r),o=n.selectAll(".buttongroup").data(r).enter().append("g").attr("class",function(t){return"action_"+t.data.code}),u=s["arc"]().innerRadius(e.r).outerRadius(e.r+30);o.append("path").attr("d",function(t){return u(t)}).attr("fill","#E6A23C").style("opacity",.6).attr("stroke","#6CB7ED").attr("stroke-width",1),o.append("text").attr("transform",function(t){return"translate("+u.centroid(t)+")"}).attr("text-anchor","middle").text(function(t){return t.data.name}).style("fill",function(){return"#fff"}).attr("font-size",10)}})},bindEventButtonGroup:function(){var t=this;t.toolbarData.forEach(function(e){var n=".action_"+e.code;t.svg.selectAll(n).on("click",function(t){console.log(t.data.name+":"+t.data.code+":uuid:"+this.selectUuid)})})},formatData:function(){var t=this,e=t.graph.links,n=t.graph.nodes;n.forEach(function(e){1!==e.center&&"1"!==e.center||(e.fx=t.width/2,e.fy=t.height/2),"undefined"!==typeof e.fx&&""!==e.fx||(e.fx=null),"undefined"!==typeof e.fy&&""!==e.fy||(e.fy=null)});var r=[];e.forEach(function(t){var e=n.filter(function(e){return e.uuid===t.sourceid})[0];if(e){var i=n.filter(function(e){return e.uuid===t.targetid})[0];i&&r.push({source:e.uuid,target:i.uuid,lk:t})}});var i={};return i.nodes=n,i.links=r,i},formatLinkAttr:function(t){var e=[];return t.forEach(function(n){var r=[],i=t.filter(function(t){return t.source===n.source&&t.target===n.target}),a=t.filter(function(t){return t.source===n.target&&t.target===n.source});r=r.concat(i),r=r.concat(a);var o=i.length+a.length;r.forEach(function(t,e){t.linkGroupIndex=e+1,t.groupLinkTotal=o}),e=e.concat(r)}),e.forEach(function(t){var e=t.groupLinkTotal/2;t.groupLinkUneven=t.groupLinkTotal%2!==0,t.groupLinkMiddle=!0===t.groupLinkUneven&&Math.ceil(e)===t.linkGroupIndex;var n=t.linkGroupIndex<=e;t.groupLinkArcDirection=1,t.groupLinkIndexCorrected=n?t.linkGroupIndex:t.linkGroupIndex-Math.ceil(e),t.groupLinkMaxHalf=Math.round(t.groupLinkTotal/2)}),e},updateGraph:function(){var t=this,e=t.formatData(),n=e.nodes,r=t.formatLinkAttr(e.links);t.drawToolButton(n);var i=t.drawNode(n),a=t.drawNodeText(n),o=t.drawButtonGroup(n),u=t.drawLink(r),c=t.drawLinkText(r);function l(){u.attr("d",function(t){var e=t.target.x-t.source.x,n=t.target.y-t.source.y,r=Math.sqrt(e*e,n*n),i=t.groupLinkUneven?0:.2,a=2,o=1/a*(r*t.groupLinkMaxHalf/(t.groupLinkIndexCorrected-i));t.groupLinkMiddle&&(o=0);var s="M"+t.source.x+", "+t.source.y+" A"+o+","+o+" 0 0, "+t.groupLinkArcDirection+" "+t.target.x+","+t.target.y;return s}),c.attr("x",function(t){if(!t.source.x||!t.target.x)return 0;var e=(parseFloat(t.source.x)+parseFloat(t.target.y))/2;return e}),i.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),o.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("transform",function(t){return"translate("+t.x+","+t.y+") scale(1)"}),a.attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}t.simulation.nodes(n).alphaTarget(0).alphaDecay(.05).on("tick",l),t.simulation.force("link").links(r),t.simulation.force("center",s["forceCenter"](t.width/2,t.height/2)),t.simulation.alpha(1).restart(),t.zoom=s["zoom"]().scaleExtent([.1,4]).on("zoom",t.zoomed),t.svg.call(t.zoom),t.svg.on("dblclick.zoom",null),t.bindEventButtonGroup()},dragStarted:function(t){s["event"].active||this.simulation.alphaTarget(.8).restart(),t.fx=t.x,t.fy=t.y},dragged:function(t){t.fx=s["event"].x,t.fy=s["event"].y},dragEnded:function(t){s["event"].active||this.simulation.alphaTarget(0),t.fx=s["event"].x,t.fy=s["event"].y},zoomed:function(){s["selectAll"](".node").attr("transform",s["event"].transform),s["selectAll"](".nodetext text").attr("transform",s["event"].transform),s["selectAll"](".line").attr("transform",s["event"].transform),s["selectAll"](".linetext text").attr("transform",s["event"].transform),s["selectAll"](".nodebutton").attr("transform",s["event"].transform)},zoomClick:function(t){var e=this,n=.2,r=1,i=e.zoom.scaleExtent();if(r=1+n*t,r<i[0]||r>i[1])return!1;e.zoom.scaleBy(e.svg,r)},zoomIn:function(){this.zoomClick(1)},zoomOut:function(){this.zoomClick(-1)},refresh:function(){this.svg.call(this.zoom.transform,s["zoomIndentity"])},showFull:function(){this.isFullscreen=!this.isFullscreen;var t=document.getElementById("kg_container");this.fullScreen(t)},fullScreen:function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscrren&&t.msRequestFullscrren()},exitFullScreen:function(){this.isFullscreen=!this.isFullscreen,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},btnCollapseNode:function(){},btnOpenNode:function(){},close:function(){}}},c=u,l=(n("76610"),n("2877")),d=Object(l["a"])(c,r,i,!1,null,null,null);e["default"]=d.exports},76610:function(t,e,n){"use strict";var r=n("01ee"),i=n.n(r);i.a}}]);